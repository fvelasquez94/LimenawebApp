@model List<LimenawebApp.Models.PurchaseData_product>
@{
    ViewBag.Title = "Distribuidora Limeña - Purchase Data";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="page__header">
    <div class="container-fluid page__heading-container">
        <div class="page__heading d-flex align-items-center">
            <div class="flex">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="#">Purchases</a></li>
                        <li class="breadcrumb-item active" aria-current="page">S&OP</li>
                    </ol>
                </nav>
                <h1 class="m-0">Product Forecast</h1>
            </div>

        </div>
    </div>
</div> <!-- // END page__header -->
<!--Page Header menu-->
@Html.Partial("~/Views/Shared/New_design/Menus/Purchases.cshtml")
<!-- Page Header -->

<div class="container-fluid page__container">
    <!-- Page Header -->
    <div class="row" style="margin-bottom:20px">
        <div class="col-md-6">

            <a href="@Url.Action("Initial_forecast", "Operations", new { iddata=ViewBag.iddata})" class="btn btn-warning float-left">
                <i class="material-icons mr-1">keyboard_backspace</i> Back
            </a>
   
        </div>
        <div class="col-md-6">
            <a href="@Url.Action("SaveandExit", "Operations", new { iddata=ViewBag.iddata})" class="btn btn-success float-right">
                <i class="material-icons mr-1">done_all</i> Save and Exit
            </a>
 
        </div>
    </div>

    <!-- /grid item -->
    <div class="form-group">
       <label>Comments:</label><br />
        <textarea id="commentagent" class="form-control border-0 shadow-none bg-focus"
                  rows="2"
                  placeholder="Comments">@ViewBag.comment</textarea>
    </div>

    <div class="card card-shadow">
        <div class="card-header">
            <div class="custom-title-wrap bar-success">
                <div class="custom-title">
                    <label>*En la siguiente tabla, se muestra el ultimo pronostico colocado al producto, por defecto se coloca el pronostico suavizado de la herramienta de Compras, pero este puede ser modificado por el pronostico de Agentes o a partir del historial de ventas en la pantalla de Sales Budget por producto</label>

                </div>
            </div>

        </div>

        <div class="card-body- pt-3 pb-4">
            <div class="table-responsive">
                <table id="data_table2" class="table table-custom" cellspacing="0">
                    <thead>
                        <tr>

                            <th scope="col">ITEMCODE</th>
                            <th scope="col">ITEM</th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                            <th scope="col"></th>
                            <th scope="col"></th>

                        </tr>
                    </thead>
                    <tfoot>
                    </tfoot>
                    <tbody>
                        @if (Model.Count == 1)
                        {
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        }
                        @foreach (var item in Model)
                        {

                            <tr>
                                <th>@item.ItemCode</th>
                                <td>@item.Description</td>
                                <td>Forecast</td>
                                <td data-toggle="tooltip" data-html="true" title="Agents forecast: @Math.Round(Convert.ToDouble(item.Forecast1_source2), 0, MidpointRounding.ToEven)">@Math.Round(Convert.ToDouble(item.Forecast1_source3), 0, MidpointRounding.ToEven)</td>
                                <td data-toggle="tooltip" data-html="true" title="Agents forecast: @Math.Round(Convert.ToDouble(item.Forecast2_source2), 0, MidpointRounding.ToEven)">@Math.Round(Convert.ToDouble(item.Forecast2_source3), 0, MidpointRounding.ToEven)</td>
                                <td data-toggle="tooltip" data-html="true" title="Agents forecast: @Math.Round(Convert.ToDouble(item.Forecast3_source2), 0, MidpointRounding.ToEven)">@Math.Round(Convert.ToDouble(item.Forecast3_source3), 0, MidpointRounding.ToEven)</td>
                                <td data-toggle="tooltip" data-html="true" title="Agents forecast: @Math.Round(Convert.ToDouble(item.Forecast4_source2), 0, MidpointRounding.ToEven)">@Math.Round(Convert.ToDouble(item.Forecast4_source3), 0, MidpointRounding.ToEven)</td>
                                <td data-toggle="tooltip" data-html="true" title="Agents forecast: @Math.Round(Convert.ToDouble(item.Forecast5_source2), 0, MidpointRounding.ToEven)">@Math.Round(Convert.ToDouble(item.Forecast5_source3), 0, MidpointRounding.ToEven)</td>
                                <td><a href="@Url.Action("edit_process", "Operations", new { data=ViewBag.iddata, ItemCode=item.ItemCode})" class="btn btn-primary">Sales Budget</a></td>
                            </tr>


                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>





<script>
    window.onload = function () {
        //Basic editor


        $('#commentagent').blur(function () {
            var comment = $.trim($("#commentagent").val());
            var iddatad = '@ViewBag.iddata';
            if (comment != "") {
                // Guardamos si no viene vacio
                $.ajax
                    ({
                        url: '/Operations/Save_dataComment',
                        type: 'POST',
                        data: { 'comment': comment, 'iddata': iddatad },
                        success: function (result) {
                            if (result == "SUCCESS") {
                                var toast = swal.mixin({
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 3000
                                });

                                toast({
                                    type: 'success',
                                    title: 'Data saved successfully.'
                                });


                            } else {
                                var toast = swal.mixin({
                                    toast: true,
                                    position: 'top-end',
                                    showConfirmButton: false,
                                    timer: 3000
                                });

                                toast({
                                    type: 'info',
                                    title: 'Something went wrong, try again'
                                });
                            }


                        },
                        error: function () {

                        },
                    });
            }
        });

    };

</script>