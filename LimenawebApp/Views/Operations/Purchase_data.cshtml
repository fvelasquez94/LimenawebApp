@model IEnumerable<LimenawebApp.Models.Purchase_data>
@{
    ViewBag.Title = "Distribuidora Limeña - Purchase Data";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    @Html.Partial("~/Views/Shared/temp_head.cshtml")
</head>
<body>

    <!-- Loader -->
    <div class="dt-loader-container">
        <div class="dt-loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"></circle>
            </svg>
        </div>
    </div>
    <!-- /loader -->
    <!-- Root -->
    <div class="dt-root">
        <div class="dt-root__inner">

            <!-- Header -->
            @Html.Partial("~/Views/Shared/temp_header.cshtml")
            <!-- /header -->
            <!-- Site Main -->
            <main class="dt-main">
                <!-- Sidebar -->
                @Html.Partial("~/Views/Shared/main_sidebar.cshtml")
                <!-- /sidebar -->
                <!-- Custom Container -->
                <div class="dt-container">

                    <!-- Site Content Wrapper -->
                    <div class="dt-content-wrapper">

                        <!-- Site Content -->
                        <div class="dt-content">

                            <!-- Page Header -->
                            <div class="dt-page__header">
                                <h1 class="dt-page__title">Data Center</h1>
                            </div>
                            <!-- /page header -->
                            <!-- Grid Item -->
                            <div class="row">
                                <div class="col-md-6 col-12">
                                    <a href="@Url.Action("new_Data", "Operations")">
                                        <!-- Card -->
                                        <div class="dt-card">

                                            <!-- Card Body -->
                                            <div class="dt-card__body p-xl-8 py-sm-8 py-6 px-4">

                                              

                                                <!-- Media -->
                                                <div class="media">

                                                    <i class="icon icon-refer icon-5x mr-xl-5 mr-3 align-self-center"></i>

                                                    <!-- Media Body -->
                                                    <div class="media-body">
                                                        <p class="mb-1 h1">Process</p>
                                                        <span class="d-block text-light-gray">Click here to start a new data process</span>
                                                    </div>
                                                    <!-- /media body -->

                                                </div>

                                                <!-- /media -->

                                            </div>
                                            <!-- /card body -->

                                        </div>
                                        <!-- /card -->
                                    </a>
                                </div>


                                <div class="col-md-6 col-12">
                                    <a href="#">
                                        <!-- Card -->
                                        <div class="dt-card">

                                            <!-- Card Body -->
                                            <div class="dt-card__body p-xl-8 py-sm-8 py-6 px-4">



                                                <!-- Media -->
                                                <div class="media">

                                                    <i class="icon icon-assignment icon-5x mr-xl-5 mr-3 align-self-center"></i>

                                                    <!-- Media Body -->
                                                    <div class="media-body">
                                                        <p class="mb-1 h1">Product Catalog</p>
                                                        <span class="d-block text-light-gray">Choose this option to go to the Product Catalog</span>
                                                    </div>
                                                    <!-- /media body -->

                                                </div>

                                                <!-- /media -->

                                            </div>
                                            <!-- /card body -->

                                        </div>
                                        <!-- /card -->
                                    </a>
                                </div>

                            </div>
                            <!--main content wrapper-->


                                        <div class="row">
                                            <div class="col-xl-12">
                                                <div class="card card-shadow">
                                                    <div class="card-header">
                                                        <div class="custom-title-wrap bar-success">
                                                            <div class="custom-title">

                                                                <div class="form-group row col-xl-4">
                                                                    <label class="col-sm-12 col-form-label col-form-label-sm">Filter by Date</label>
                                                                    <div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px;margin-left: 14px; margin-right:15px; border: 1px solid #ccc; width: 100%">
                                                                        <i class="mdi mdi-calendar"></i>&nbsp;
                                                                        <span></span> <i class="fa fa-caret-down"></i>
                                                                    </div>

                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
   
                                                    <div class="card-body- pt-3 pb-4">
                                                        <div class="table-responsive">
                                                            <table id="data_table2" class="table table-hover table-custom" cellspacing="0">
                                                                <thead>
                                                                    @*<tr>
                                                    <th rowspan="2">ID</th>
                                                    <th rowspan="2">Date</th>
                                                    <th colspan="1">FILTERS</th>

                                                </tr>*@
                                                                    <tr>

                                                                        <th scope="col">ID</th>
                                                                        <th scope="col">DATE</th>
                                                                        <th scope="col">VENDOR</th>
                                                                        <th scope="col">CATEGORY</th>
                                                                        <th scope="col">SUB CATEGORY</th>
                                                                        <th scope="col">BRAND</th>
                                                                        <th scope="col">ACTIONS</th>
                                                                    </tr>
                                                                </thead>
                                                                <tfoot>
                                                                </tfoot>
                                                                <tbody>
                                                                    @foreach (var item in Model)
                                            {
                                                <tr>
                                                    <td>@item.ID_purchaseData</td>
                                                    <td style="font-size:11px;">@Convert.ToDateTime(item.Date_create).AddHours(-6)</td>
                                                    <td style="font-size:11px;">@item.Providers</td>
                                                    <td style="font-size:11px;">@item.Categories</td>
                                                    <td style="font-size:11px;">@item.SubCategories</td>
                                                    <td style="font-size:11px;">@item.Brands</td>
                                                    <td>
                                                        <a href="@Url.Action("edit_purchaseData", "Operations", new { id = item.ID_purchaseData })" class="btn btn-sm btn-outline-info btn-sm form-pill"><i class="fa fa-external-link"></i>Edit</a>
                                                        <a href="@Url.Action("PurchaseData_Export", "Operations", new { id = item.ID_purchaseData })" class="btn btn-sm btn-outline-success btn-sm form-pill"><i class="fa fa-file-excel-o"></i>Export</a>
                                                        <a href="#" id="@item.ID_purchaseData" class="btn btn-sm btn-outline-danger btn-sm form-pill delbtn"><i class="fa fa-close"></i>Del</a>
                                                    </td>
                                                </tr>
                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                            <!-- /grid item -->


                        </div>
                        <!-- /site content -->

                    </div>
                    <!-- /site content wrapper -->

                </div>
                <!-- /custom Container -->

            </main>
            <!-- /main -->
            <!-- Footer -->
            <footer class="dt-footer">
                <div class="dt-container">
                    Copyright Distribuidora Limena © 2019
                </div>
            </footer>
            <!-- /footer -->

        </div>
    </div>
    <!-- /root -->
    @Html.Partial("~/Views/Shared/main_Scripts.cshtml")

</body>
</html>




<script>
    $(document).ready(function () {
        $(".delbtn").click(function () {
            var contentPanelId = jQuery(this).attr("id");
            id_data = contentPanelId;

            Del_PurchaseData(id_data);
        });

        $("#data_table2").DataTable({
            "lengthChange": false
        });

        function Del_PurchaseData(id_data) {


            swal.fire({
                title: 'Are you sure to delete this data?',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3dba6f',
                cancelButtonColor: '#aaa',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.value) {

                    $.ajax({
                        url: '/Operations/Del_PurchaseData',
                        type: 'POST',
                        data: { 'id': id_data },
                        cache: false,
                        global: false,
                        success: function (result) {

                            if (result == "SUCCESS") {

                                Swal.fire(
                                    'Data deleted!',
                                    'The Data has been deleted.',
                                    'success'
                                )
                                window.location.reload(true);
                            }
                            else {
                                //alert("Something went wrong..");
                                toastr.info("Deleting details...", "Delete");
                                repeatdel(id_data);

                            }


                        },
                        error: function (request) {
                            //alert("Something went wrong..");
                        }
                    });

                }
            })
        }

        function repeatdel(id_data) {
            $.ajax({
                url: '/Operations/Del_PurchaseData',
                type: 'POST',
                data: { 'id': id_data },
                cache: false,
                global: false,
                success: function (result) {

                    if (result == "SUCCESS") {

                        Swal.fire(
                            'Data deleted!',
                            'The Data has been deleted.',
                            'success'
                        )
                        window.location.reload(true);
                    }
                    else {
                        //alert("Something went wrong..");
                        toastr.info("Deleting details...", "Delete");
                        repeatdel(id_data);
                    }


                },
                error: function (request) {
                    //alert("Something went wrong..");
                }
            });

        }
        //var classname = document.getElementsByClassName("delbtn");

        //for (var i = 0; i < classname.length; i++) {
        //    classname[i].addEventListener('click', Del_PurchaseData, false);
        //}
    });
</script>
<script type="text/javascript">
    window.onload = function (e) {

        var flag = 0;


                //DATETIMEPICKER
 var t1 = "@ViewBag.filtrofechastart";
        var t2 = "@ViewBag.filtrofechaend";

        var start = moment(t1, "MM-DD-YYYY");
        var end = moment(t2, "MM-DD-YYYY");

        function cb(start, end) {
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            if (flag == 0) {
                flag = 1;
            } else {
                filterSObydate();
            }


        }

        $('#reportrange').daterangepicker({

            startDate: start,
            endDate: end,
            autoApply: false,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);

        cb(start, end);


        function filterSObydate() {
            var st = new Date($('#reportrange').data('daterangepicker').startDate);
            var ed = new Date($('#reportrange').data('daterangepicker').endDate);

            st = st.toLocaleDateString();
            ed = ed.toLocaleDateString();
            //colocamos la url de la demo
            var url = '@Url.Action("Purchase_data", "Operations", new { fstartd = "dad", fendd="tfe" })';
            url = url.replace('dad', st);
            var newurl = url;
            newurl = newurl.replace('tfe', ed);

            newurl = newurl.replace(/&amp;/g, "&");

            window.location.href = newurl;
        };



    }
</script>

