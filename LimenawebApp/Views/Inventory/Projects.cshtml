@model List<LimenawebApp.Models.Inv_Projects>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    @Html.Partial("~/Views/Shared/temp_head.cshtml")

</head>
<body>

    <!-- Loader -->
    <div class="dt-loader-container">
        <div class="dt-loader">
            <svg class="circular" viewBox="25 25 50 50">
                <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"></circle>
            </svg>
        </div>
    </div>
    <!-- /loader -->
    <!-- Root -->
    <div class="dt-root">
        <div class="dt-root__inner">

            <!-- Header -->
            @Html.Partial("~/Views/Shared/temp_header.cshtml")
            <!-- /header -->
            <!-- Site Main -->
            <main class="dt-main">
                <!-- Sidebar -->
                @Html.Partial("~/Views/Shared/main_sidebar.cshtml")
                <!-- /sidebar -->
                <!-- Custom Container -->
                <div class="dt-container">

                    <!-- Site Content Wrapper -->
                    <div class="dt-content-wrapper">

                        <!-- Site Content -->
                        <div class="dt-content">

                            <!-- Page Header -->
                            <div class="dt-page__header">
                                <ol class="breadcrumb" style="display:flow-root;">
                                    <li class="breadcrumb-item float-left"></li>

                                    <li class="breadcrumb-item float-right">Projects </li>
                                    <li class="breadcrumb-item float-right">Inventory</li>



                                </ol>
                            </div>
                            <!-- /page header -->
                            <div class="dt-entry__header">

                                <!-- Entry Heading -->
                                <div class="dt-entry__heading">
                                    <h3 class="dt-entry__title">Projects</h3>
                                </div>
                                <!-- /entry heading -->
                                @if (ViewBag.adminRole)
                                {
                                    <a href="@Url.Action("Projects_new", "Inventory")" class="btn btn-shadow btn-default compose-btn btn-rounded">
                                        <i class="icon icon-plus icon-fw mr-2"></i>New project
                                    </a>
                                }

                            </div>
                            <!-- Grid -->
                            <div class="row">

                                <!-- Grid Item -->
                                <div class="col-xl-12">
                                    @foreach (var project in Model)
                                    {
                                        <!-- Card -->
                                        <div class="dt-card">

                                            <!-- Card Body -->
                                            <div class="dt-card__body">

                                                <!-- List -->
                                                <div class="d-sm-flex flex-sm-row">

                                                    <!-- User Avatar
                                                    <img class="dt-avatar size-60 mr-6 mb-6 mb-sm-0"
                                                         src="https://via.placeholder.com/150x150" alt="User">
                                                    <!-- /user avatar-->
                                                    <!-- Content -->
                                                    <div class="flex-1 overflow-hidden mb-6 mb-sm-0 pr-sm-3">
                                                        <div class="user-detail mb-3">
                                                            <span class="user-name">@project.Name</span>
                                                            <span class="dt-separator-v">&nbsp;</span>
                                                            @if (project.isfinished == true)
                                                            {<span class="badge sm badge badge-info mb-1 mr-1">Closed</span>
                                                            }
                                                            else
                                                            {<span class="badge sm badge badge-success mb-1 mr-1"> Open</span>

                                                            }
                                                        </div>
                                                        <div style="text-align:justify;">
                                                            @project.Description
                                                        </div>

                                                        <span class="min-w-150 d-inline-block border-top mb-2"></span>
                                                        <div class="d-flex flex-wrap mb-4">
                                                            @*if (ViewBag.adminRole==false)
                                                            {
                                                        <div class="pr-3">Assigned locations: <span class="text-dark">ViewBag.cuenta</span></div>}*@
                                                        <div class="pr-3">Total locations: <span class="text-dark">@project.Areas</span></div>
                                                        <div>Date: <span class="text-dark">@project.Creation_date.ToShortDateString()</span></div>
                                                        </div>
                                                        <div class="d-flex flex-sm-row flex-column">
                                                            <div>Progress: &nbsp; </div>
                                                            <div class="dt-indicator-item__info" data-fill="0" data-max="100"
                                                                 data-percent="true"
                                                                 data-sufix="Job Success" style="width: 220px">
                                                                <span class="dt-indicator-item__count text-success text-nowrap mr-3">0</span>
                                                                <div class="dt-indicator-item__bar">
                                                                    <div class="dt-indicator-item__fill bg-success"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- /content -->

                                                    <div class="min-w-120">
                                                        @if (ViewBag.adminRole)
                                                        {
                                                            <a href="#" data-idproj="@project.ID_project" data-maxcounts="@project.Max_counts"   data-toggle="modal" data-target="#composeModal"
                                                               class="btn btn-primary text-uppercase btn-block">Details</a> @*<a href="Url.Action("Binloc_master", "Inventory")"
                                                                class="btn btn-primary text-uppercase btn-block">Details</a>*@

                                                            if (project.isfinished == false)
                                                            {
                                                                <a href="javascript:void(0)" onclick="deleteRequest(@project.ID_project)" class="btn btn-outline-light text-light-gray text-uppercase btn-block">
                                                                    <i class="icon icon-trash icon-fw"></i> <span>Delete</span>
                                                                </a>}


                                                        }
                                                        else
                                                        {
                                                            <a href="@Url.Action("Binloc", "Inventory", new { id=project.ID_project})"
                                                               class="btn btn-primary text-uppercase btn-block">Details</a>
                                                        }


                                                    </div>

                                                </div>

                                                <!-- /list -->

                                            </div>
                                            <!-- /card body -->

                                        </div>}
                                    <!-- /card -->

                                </div>
                                <!-- /grid item -->



                            </div>
                            <!-- /grid -->

                        </div>
                        <!-- /site content -->

                    </div>
                    <!-- /site content wrapper -->

                </div>
                <!-- /custom Container -->

            </main>
            <!-- /main -->
            <!-- Footer -->
            @Html.Partial("~/Views/Shared/main_footer.cshtml")
            <!-- /footer -->

        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade contact-modal" id="composeModal" tabindex="-1" role="dialog" aria-hidden="true">

        <!-- Modal Dialog -->
        <div class="modal-dialog modal-sm" role="document">
            <!-- Modal Content -->
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">
                        Project Details
                    </h4>
                    <a href="javascript:void(0)" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="icon icon-remove icon-fw icon-xl"></i>
                    </a>
                </div>
                <!-- /modal header -->
                <!-- Modal Body -->
                <div class="modal-body">
                    <div class="row no-gutters">

                        <input hidden id="IDprojectDet" type="text" />
                        <div class="col-lg-12 order-lg-1">
                     
                                <div class="form-group">
                                    <label>Select an option</label>
                                    <select id="optionsProject" class="form-control">

                                    </select>
                                </div>

                           
                          
                        </div>
                    </div>
                </div>
                <!-- /modal body -->
                <!-- Modal Footer -->
                <div class="modal-footer">
                    <a class="btn btn-primary" id="btngo" href="javascript:void(0)" data-dismiss="modal">
                         <span>GO</span>
                    </a>
                </div>
                <!-- /modal footer -->
            </div>
            <!-- /modal content -->
        </div>
        <!-- /modal dialog -->

    </div>
    <!-- /modal -->
    <!-- /root -->
    @Html.Partial("~/Views/Shared/main_Scripts.cshtml")
    <script>

        $(document).on("click", "#btngo", function () {


            if ($("#optionsProject").val() == "General") {
                            var url = '@Url.Action("Binloc_general", "Inventory", new { idproj = "TTF"})';                
                url = url.replace('TTF', $("#IDprojectDet").val());                                     
            url = url.replace('amp;', '');
            //newurl = newurl.replace('amp;', '');
            window.location.href = url;

            } else if ($("#optionsProject").val() == "Details") {
                            var url = '@Url.Action("Binloc", "Inventory", new { id = "TTF", messagetoken = "", })';                
                url = url.replace('TTF', $("#IDprojectDet").val());                                      
            url = url.replace('amp;', '');
            //newurl = newurl.replace('amp;', '');
            window.location.href = url;
            } else {
            var url = '@Url.Action("Binloc_master", "Inventory", new { idproj = "TTF", count = "KKP" })';                
                url = url.replace('TTF', $("#IDprojectDet").val());                          
                url = url.replace('KKP', $("#optionsProject").val());              
            url = url.replace('amp;', '');
            //newurl = newurl.replace('amp;', '');
            window.location.href = url;
            }

        });

                    function deleteRequest(id) {

                swal({
                    title: "Delete project",
                    text: "Are you sure you want to delete this project?",
                    icon: "warning",
                    showCloseButton: true,
                    showCancelButton: true,
                    confirmButtonColor: '#3d4a6d',
                    focusConfirm: false,
                    confirmButtonText: 'Yes',
                    cancelButtonText: 'No'
                }).then((willDelete) => {
                    if (willDelete.value) {

                            var url = '@Url.Action("DeleteProject", "Inventory", new { id = "AUREQ" })';
                        url = url.replace('AUREQ', id);
                        var newurl = url;
                        window.location.href = newurl;
                        } else {

                        }
                    });

        }


        (function ($) {
            'use strict';
            $('#composeModal').on('show.bs.modal', function (event) {

                var button = $(event.relatedTarget);// Button that triggered the modal

                var IDproj = button.data("idproj");// Extract info from data-* attributes
                var Maxcounts = button.data("maxcounts");

                $("#optionsProject").html("");

                for (var i = 1; i <= Maxcounts; i++) {
                    $("#optionsProject").append
                        ($('<option></option>').val(i).html("Count " + i));
                }
                var issuperadmin = '@ViewBag.issuperadmin';
                if (issuperadmin == "1") {
                    $("#optionsProject").append($('<option></option>').val("General").html("General"));
                }
                
                var isadminandpicker = '@ViewBag.isadminandticker';
                if (isadminandpicker == "1") {
                    $("#optionsProject").append($('<option></option>').val("Details").html("Details"));
                }

                //$("#optionsProject").append($('<option></option>').val("Schema").html("Schema"));

                var modal = $(this);
                //modal.find('.modal-title').text('Edit data: ' + recipient)
            
                $("#IDprojectDet").val(IDproj);

            })
        })(jQuery);

    </script>
</body>
</html>
