
@{
    ViewBag.Title = "Distribuidora Limeña - Marketing activities";
}

<!--main content wrapper-->
<div class="content-wrapper">
    <!--/creative states-->
    <div class="box-container">
        <div class="container-fluid">
            <!--sales monitor-->
            <div class="row">
                <div class="col-12">
                    @if (ViewBag.isAdmin == 1)
                    {
                        <a href="@Url.Action("Routes_details", "Commercial", new { id = ViewBag.id_route })" class="btn btn-sm btn-info mb-2">Back</a>}
                    <div class="card card-shadow mb-4">
                        <div class="card-header border-0">
                            <div class="custom-title-wrap bar-turquoise">
                                <div class="custom-title">VISIT INFO</div>

                                <div class=" widget-action-link">
                                    <div class="dropdown">


                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">

                                <div class="col-xl-6 col-md-6">
                                    <div class="card card-shadow mb-4">
                                        <div class="card-body">

                                            <div class="text-center">
                                                <div class="mt-4 mb-3">
                                                    <img class="" src="~/Content/appcontent/assets/img/store.png" width="75" alt="" />
                                                </div>
                                                <h5 class="text-uppercase mb-0" id="storeName">STORE NAME</h5>
                                                <p class="text-muted mb-0" id="storeAddress">STORE ADDRESS </p>
                                                <p class="text-muted mb-0" id="storeDate">STORE DATE </p>
                                                <div class="rattings mb-4">
                                                    @*<i class="fa fa-star-o text-warning"></i>
                                                        <i class="fa fa-star-o text-warning"></i>
                                                        <i class="fa fa-star-o text-warning"></i>
                                                        <i class="fa fa-star-o text-warning"></i>
                                                        <i class="fa fa-star-o text-warning"></i>*@
                                                </div>

                                                <div class="mb-2">
                                                    <a id="getdirections" href="#" class="btn btn-sm btn-pill btn-primary pl-4 pr-4"><i class="fa fa-map-o"></i> Get directions</a>
                                                    @if (ViewBag.isAdmin == 1)
                                                    {
                                                        if (ViewBag.estadovisita != 4)
                                                        {
                                                            <a href="#" data-toggle="modal" data-target="#createModal" class="btn btn-sm btn-pill btn-success pl-4 pr-4"><i class="fa fa-plus"></i> Add activity</a>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (ViewBag.estadovisita == 3)
                                                        {
                                                            <a href="#" onclick="checkinVisit()" class="btn btn-sm btn-pill btn-success pl-4 pr-4"><i class="fa fa-user-times"></i> Check in</a>
                                                            <a href="#" onclick="cancelVisit()" class="btn btn-sm btn-pill btn-warning pl-4 pr-4"><i class="fa fa-times"></i> Cancel Visit</a>
                                                        }
                                                        else if (ViewBag.estadovisita == 2)
                                                        {
                                                            <a href="#" onclick="checkoutVisit()" class="btn btn-sm btn-pill btn-danger pl-4 pr-4"><i class="fa fa-clock-o"></i> Check out</a>
                                                        }else if (ViewBag.estadovisita == 1)
                                                        {
                                                            <span class="badge badge-warning form-pill px-3 py-1">Visit Canceled</span>
                                                        }


                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xl-4 col-md-4" style="display:none;">
                                    <div class="card card-shadow">
                                        <div class="card-body">
                                            <div class="mb-4">
                                                <div class="progress-title">
                                                    <span>Forms</span>
                                                    <span id="forms_p1" class="float-right">0% (0/0)</span>
                                                </div>
                                                <div class="progress" style="height: 1px;">
                                                    <div id="forms_d1" class="progress-bar bg-warning" role="progressbar" style="width: 0%;" aria-valuemax="100"></div>
                                                </div>

                                            </div>
                                            <div class="mb-4">
                                                <div class="progress-title">
                                                    <span>Audits</span>
                                                    <span id="audits_p1" class="float-right">0% (0/0)</span>
                                                </div>
                                                <div class="progress" style="height: 1px;">
                                                    <div id="audits_d1" class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                            <div class="mb-4">
                                                <div class="progress-title">
                                                    <span>Sales Orders </span>
                                                    <span id="sales_p1" class="float-right">0% (0/0)</span>
                                                </div>
                                                <div class="progress" style="height: 1px;">
                                                    <div id="sales_d1" class="progress-bar bg-danger" role="progressbar" style="width: 0%;" aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                <div class="progress-title">
                                                    <span>Demos</span>
                                                    <span id="demos_p1" class="float-right">0% (0/0)</span>
                                                </div>
                                                <div class="progress" style="height: 1px;">
                                                    <div id="sales_d1" class="progress-bar bg-info" role="progressbar" style="width: 0%;" aria-valuemax="100"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-md-6">
                                    <div class="card card-shadow mb-4">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <p class="control-label col-md-10">Comment:</p>

                                                <div class="col-md-12">
                                                    <textarea style="font-size:11px;" id="visitComment" placeholder="There are no comments yet..." rows="5" class="form-control"></textarea><br />
                                                    <button class="btn btn-sm btn-success" onclick="saveComment()">Save</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--/sales monitor-->
            <div class="row">
                <div class="col-12">
                    <div class="card card-shadow mb-4">
                        <div class="card-header border-0">
                            <div class="custom-title-wrap bar-primary">
                                <div class="custom-title">ACTIVITIES LIST</div>

                            </div>

                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table id="data_table" class="table table-hover table-custom" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th scope="col">ID</th>

                                            <th scope="col">DESCRIPTION</th>
                                            <th scope="col">BRAND</th>
                                            <th scope="col">SUBCATEGORY</th>
                                            @if (ViewBag.isAdmin == 1)
                                            {
                                                <th scope="col">REPS</th>}

                                            <th scope="col">STATUS</th>
                                            <th scope="col">ACTIONS</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                    </tfoot>
                                    <tbody id="tbodyid"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>



<!-- contact form start -->
@*<div class="floating-form card card-shadow" id="contact_form">
        <div class="contact-opener custom-title">Settings</div>
        <div class="floating-form-heading  custom-title">Filters</div>
        <hr />
        <div id="contact_body">
            <div class="form-group row">
                <label class="col-sm-12 col-form-label col-form-label-sm">Date</label>
                <div id="reportrange" style="background: #fff; cursor: pointer; padding: 5px 10px;margin-left: 14px; margin-right:15px; border: 1px solid #ccc; width: 100%">
                    <i class="mdi mdi-calendar"></i>&nbsp;
                    <span></span> <i class="fa fa-caret-down"></i>
                </div>
            </div>
            <div class="form-group row">
                <label class="col-sm-12 col-form-label col-form-label-sm">User</label>
                <div class="col-sm-12">
                    <select class="form-control" id="option_Users" name="option_Users" onchange="getStores()"></select>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-12 col-form-label col-form-label-sm">Store</label>
                <div class="col-sm-12">
                    <select class="form-control" id="option_Stores" name="option_Stores" onchange="getVisitData()"></select>
                </div>
            </div>
        </div>
    </div>*@
<!-- contact form end -->
<!--CREATE ACTIVITY STARTS-->
<div class="modal fade" id="createModal" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h6 class="modal-title" id="exampleModalLabel-4"><i class="fa fa-file"></i> ADD NEW ACTIVITY</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="font-size: 40px" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">


                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Activity:</label>
                        <select id="ID_form" name="ID_form" class="form-control" style="width:100%" onchange="getActivity()">
                            <option value="0">Select an activity</option>
                            <optgroup label="Demos">
                                @foreach (var form in ViewBag.activeforms)
                                {
                                    if (form.ID_activity == 4)
                                    {
                                        <option value="@form.ID_form">@form.name</option>
                                    }
                                }
                            </optgroup>
                            <optgroup label="Forms"></optgroup>
                            @foreach (var form in ViewBag.activeforms)
                            {
                                if (form.ID_activity == 1)
                                {

                                    <option value="@form.ID_form">@form.name</option>


                                }
                            }
                            <optgroup label="Audits"></optgroup>
                            @foreach (var form in ViewBag.activeforms)
                            {
                                if (form.ID_activity == 2)
                                {
                                    <option value="@form.ID_form">@form.name</option>
                                }
                            }
                            <optgroup label="Sales Order">
                                @foreach (var form in ViewBag.activeforms)
                                {
                                    if (form.ID_activity == 3)
                                    {
                                        <option value="@form.ID_form">@form.name</option>
                                    }
                                }
                            </optgroup>
                        </select>
                    </div>
                    @*<div class="form-group">
                            <label for="recipient-name" class="col-form-label">Set start date:</label>
                            <input type="datetime-local" class="form-control" name="time" id="time" />
                        </div>*@
                    @*<div class="form-group">
                            <label for="recipient-name" class="col-form-label">User:</label>
                            <select name="ID_rep" id="ID_rep" class="form-control" style="width:100%">
                                <option value="0">Select an user</option>
                            </select>
                        </div>*@

                    @*<div class="form-group">
                            <label for="recipient-name" class="col-form-label">Customer:</label>
                            <select name="ID_customer" id="ID_customer" class="form-control" style="width:100%" >
                                <option value="0">Select a Customer</option>
                            </select>
                        </div>*@
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Brand:</label>
                        <select name="ID_brand" id="ID_brand" class="form-control" style="width:100%" onchange="getCategories()">
                            <option value="0">Select a Brand</option>
                        </select>
                    </div>
                    <div id="moreoptions" style="display:none;">
                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">Category:</label>
                            <select name="ID_cat" id="ID_cat" class="form-control" style="width:100%" onchange="getSubcategories()">
                                <option value="0">Select a Category</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="recipient-name" class="col-form-label">SubCategory:</label>
                            <select name="ID_subcat" id="ID_subcat" class="form-control" style="width:100%"></select>
                        </div>


                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="createActivity()" class="btn btn-info">Add</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!--CREATE ACTIVITY ENDS-->
<!--CANCEL DATA STARTS-->
<div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-5"><i class="mdi mdi-delete"></i> Cancel Activity</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="font-size: 40px" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-form-label">Are you sure you want to cancel this activity?</label><br />
                        <strong><label id="descriptionC" class="col-form-label"></label></strong>
                        <input type="text" id="ID_activityC" name="ID_activityC" hidden />
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" onclick="cancelActivity()" class="btn btn-danger">Yes</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">No</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!--CANCEL DATA ENDS-->
<!--DELETE DATA STARTS-->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-delete"></i> Delete Activity Data</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="font-size: 40px" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-form-label">Are you sure you want to delete this activity?</label><br />
                        <strong><label id="descriptionD" class="col-form-label"></label></strong>
                        <input type="text" id="ID_activityD" name="ID_activityD" hidden />
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="button" onclick="deleteActivity()" class="btn btn-danger">Delete</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!--DELETE DATA ENDS-->
<!--COPY DATA STARTS-->
<div class="modal fade" id="copyModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("copyActivity", "VisitsMs", FormMethod.Post))
            {
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel-4"><i class="mdi mdi-delete"></i>Copy activity</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span style="font-size: 40px" aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="form-group">
                        <label class="col-form-label">Are you sure you want to copy this activity?</label>
                        <strong><label id="descriptionCopy" class="col-form-label"></label></strong>
                        <input type="text" id="ID_activityCopy" name="ID_activityCopy" value="" hidden />
                        <input type="text" id="ID_visitCopy" name="ID_visitCopy" value="" hidden />
                    </div>


                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger" onClick="this.form.submit(); this.disabled=true; this.value='Copying…'; ">Copy</button>
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                </div>
            }
        </div>
    </div>
</div>
<!--COPY DATA ENDS-->

<script type="text/javascript">
    window.onload = function (e) {

        getVisitData();


        @*var _scroll = true, _timer = false, _floatbox = $("#contact_form"), _floatbox_opener = $(".contact-opener");
        _floatbox.css("right", "-322px"); //initial contact form position

        //Contact form Opener button
        _floatbox_opener.click(function () {
            if (_floatbox.hasClass('visiable')) {
                _floatbox.animate({ "right": "-322px" }, { duration: 300 }).removeClass('visiable');
            } else {
                _floatbox.animate({ "right": "0px" }, { duration: 300 }).addClass('visiable');
            }
        });

        //Effect on Scroll
        $(window).scroll(function () {
            if (_scroll) {
                _floatbox.animate({ "top": "30px" }, { duration: 300 });
                _scroll = false;
            }
            if (_timer !== false) { clearTimeout(_timer); }
            _timer = setTimeout(function () {
                _scroll = true;
                _floatbox.animate({ "top": "60px" }, { easing: "linear" }, { duration: 500 });
            }, 400);
        });

        //DATETIMEPICKER
        var t1 = "@ViewBag.filtrofechastart";
        var t2 = "@ViewBag.filtrofechaend";

        var start = moment(t1, "MM-DD-YYYY");
        var end = moment(t2, "MM-DD-YYYY");

        function cb(start, end) {
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));

            getStores();
        }

        $('#reportrange').daterangepicker({

            startDate: start,
            endDate: end,
            autoApply: true,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);

        cb(start, end);


        //USERS
        var dataUsers = @Html.Raw(ViewBag.lstUsers);

        $('#option_Users').select2({
            placeholder: "Select an user",
            data: dataUsers
        });

        $('#ID_rep').select2({
            placeholder: "Select an user",
            data: dataUsers
        });

        //STORES
        if (document.getElementById("option_Stores")) {
            getStores();
        } else {

        }

        //CUSTOMERS
        var dataCustomers = @Html.Raw(ViewBag.lstCustomer);

        $('#ID_customer').select2({
            placeholder: "Select a Customer",
            data: dataCustomers
        });

    }*@
                //BRAND
        var dataBrands = @Html.Raw(ViewBag.lstBrands);

        $('#ID_brand').select2({
            placeholder: "Select a Brand",
            data: dataBrands
        });

        //USERS
        var dataUsers = @Html.Raw(ViewBag.lstUsers);


        $('#ID_rep').select2({
            placeholder: "Select an user",
            data: dataUsers
        });

        @*//CUSTOMERS
        var dataCustomers = @Html.Raw(ViewBag.lstCustomer);

        $('#ID_customer').select2({
            placeholder: "Select a Customer",
            data: dataCustomers
        });*@



        //function getStores() {
        //    var UserId = $("#option_Users").val();
        //    var st = new Date($('#reportrange').data('daterangepicker').startDate);
        //    var ed = new Date($('#reportrange').data('daterangepicker').endDate);

        //    st = st.toLocaleDateString();
        //    ed = ed.toLocaleDateString();
        //    $.ajax
        //        ({
        //            url: '/Commercial/GetStores',
        //            type: 'POST',
        //            datatype: 'application/json',
        //            contentType: 'application/json',
        //            data: JSON.stringify({
        //                UserId: UserId,
        //                start: st,
        //                end: ed
        //            }),
        //            success: function (result) {

        //                var dataStores = JSON.parse(result);
        //                $("#option_Stores").html("");

        //                $('#option_Stores').select2({
        //                    placeholder: "No data to show",
        //                    data: dataStores
        //                });

        //                if (dataStores.length > 0) {
        //                    getVisitData();




        //                } else {
        //                        var table = $('#data_table').DataTable();

        //                        table
        //                            .clear()
        //                            .draw();

        //                    $("#storeName").html("NO STORE SELECTED");
        //                    $("#storeAddress").html("");
        //                    $("#getdirections").attr("href", "#");
        //                    $("#getdirections").attr('target', '_self');
        //                    //STATS
        //                    $("#forms_p1").html("0% (0/0)");
        //                    $('#forms_d1').css('width', '0%');
        //                    $("#audits_p1").html("0% (0/0)");
        //                    $("#audits_d1").css('width', '0%');
        //                    $("#sales_p1").html("0% (0/0)");
        //                    $("#sales_d1").css('width', '0%');
        //                    $("#demos_p1").html("0% (0/0)");
        //                    $("#demos_d1").css('width', '0%');

        //                }




        //            },
        //            error: function () {
        //                alert("Whooaaa! Something went wrong...")
        //            },
        //        });



        //}




    }
</script>



