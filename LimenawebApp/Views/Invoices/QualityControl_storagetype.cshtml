@{
    ViewBag.Title = "Distribuidora Limeña - Quality Control ST";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}


<div class="page__header">
    <div class="container-fluid page__heading-container">
        <div class="page__heading d-flex align-items-center">
            <div class="flex">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="#">Operations</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Quality Control</li>
                    </ol>
                </nav>
                <h1 class="m-0">Quality Control</h1>
            </div>

        </div>
    </div>
</div> <!-- // END page__header -->
<!--Page Header menu-->
@Html.Partial("~/Views/Shared/New_design/Menus/Operations.cshtml")
<div class="container-fluid page__container">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header card-header-large bg-white d-flex align-items-center">
                    <h4 class="card-header__title flex m-0">Sales Orders in Route</h4>
                    <div>
                        <a href="@Url.Action("QualityControl_planning", "Invoices")" class="btn btn-info">Back</a>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="data_tableEditor2" class="table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>DOC NUM</th>
                                <th>DATE</th>
                                <th>CUSTOMER</th>
                                @*<th>SALES REP</th>*@
                                <th>TOTAL</th>
                                <th>STATUS</th>
                                <th>ACTIONS</th>


                            </tr>
                        </thead>
                        <tfoot>
                        </tfoot>
                        <tbody>
                            @foreach (var so in ViewBag.lstSO)
                {
                    <tr class="treegrid-@Html.Raw(so.ID_salesorder)" style="background-color: rgba(0, 0, 0, .02);">
                        <td style="padding: .25rem;">
                            @so.SAP_docnum
                            @if (so.isfinished == true && so.DocEntry != "")
                {<small class="text-success">(Invoiced)</small>
    }


    else if (so.isfinished == true && so.DocEntry == "")
    {
            <small class="text-success">(Closed)</small>
}
                        </td>
                        <td style="padding: .25rem;">@Convert.ToDateTime(so.SAP_docdate).ToShortDateString()</td>
                        <td style="padding: .25rem;">@so.ID_customer - @so.Customer_name</td>
                        @*<td style="padding: .25rem;">@so.Rep_name</td>*@
                        <td style="padding: .25rem;">$@Convert.ToDecimal(so.Amount).ToString("n2")</td>
                        <td style="padding: .25rem;">
                            <div class="progress-title">
                                <span id="forms_p1" class="">@Convert.ToDecimal(so.query1).ToString("n2")%</span>
                            </div>
                            <div class="progress" style="height: 2px;">
                                @if (Convert.ToDecimal(so.query1) < 100)
                    {
                        <div class="progress-bar bg-warning" role="progressbar" style="width: @so.query1%;" aria-valuemax="100"></div>
        }
        else
        {
            <div class="progress-bar bg-success" role="progressbar" style="width: @so.query1%;" aria-valuemax="100"></div>
}
                            </div>
                        </td>
                        <td style="padding: .25rem;">
                            @if (so.isfinished == true && so.DocEntry != "")
                {
                    <a href="#" onclick="PrintSO(@so.ID_Route,@so.DocEntry)" class="btn btn-sm btn-outline-warning btn-sm form-pill"><i class="fa fa-print"></i>Print</a>
    }


            @*@if (Convert.ToDecimal(so.query1) >= 100)
        {
            if (so.isfinished == false)
            {
                                                    <a href="#" class="btn btn-sm btn-outline-success btn-sm form-pill" onclick="closeSO(@so.ID_salesorder)"><i class="fa fa-close"></i>Close</a>
    }

    }
                                                        @if (so.query2=="(0/ 0)" ) { <a href="#" class="btn btn-sm btn-outline-success btn-sm form-pill" onclick="closeSO(@so.ID_salesorder)"><i class="fa fa-close"></i>Close</a>}*@
                        </td>
                    </tr>
        foreach (var childso in ViewBag.lstSO_children)
        {
            if (childso.ID_salesOrder == so.ID_salesorder)
            {
                <tr class="treegrid-parent-@Html.Raw(so.ID_salesorder)">
                    <td style="padding: .15rem;"> </td>
                    <td style="padding: .15rem;"></td>
                    <td style="padding: .15rem;">

                        @if (childso.Storage == "COOLER" || childso.Storage == "FREEZER")
            {
                @Html.Raw("(COOLER, FREEZER)");
}
else
{
            @childso.Storage
}




                    </td>
                    <td style="padding: .15rem;">
                        @if (childso.Picker == "")
            {
                <label>PICKER: NOT ASSIGNED</label>

}
else
{
            <label>PICKER: @childso.Picker</label>
}

                    </td>

                    <td style="padding: .15rem;">
                        @if (childso.delete == 1)
            {
                <label class="badge text-warning">Deleted</label>
}
else
{
            <div class="progress-title">
                <span id="forms_p2" class="">@Convert.ToDecimal(childso.data1).ToString("n2")% </span>
            </div>
            <div class="progress" style="height: 2px;">
                @if (Convert.ToDecimal(childso.data1) < 100)
    {
            <div class="progress-bar bg-warning" role="progressbar" style="width: @childso.data1%;" aria-valuemax="100"></div>
}
else
{
            <div class="progress-bar bg-success" role="progressbar" style="width: @childso.data1%;" aria-valuemax="100"></div>
}
            </div>
}


                    </td>
                    <td style="padding: .15rem;">
                        @if (so.isfinished == false)
            {

                <a href="#" class="btn btn-sm btn-outline-info btn-sm form-pill" data-saleso="@so.ID_salesorder" data-saledoc="@so.SAP_docnum" data-salestorage="@childso.ID_storage" data-picker="@childso.Picker" onclick="getSOdataByStorage(this)"><i class="fa fa-external-link"></i>View</a>
}

                    </td>
                </tr>
}


}

}

                        </tbody>
                    </table>
                </div>


            </div>
                    </div>


                </div>
                </div>



